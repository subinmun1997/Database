# Database 이론

* [관계형 DB에서의 관계](#관계형-DB에서의-관계)

* [Connection pool](#Connection-pool)

* [데이터베이스 시스템 개요](#데이터베이스-시스템-개요)

* [DB 설계 개요](#DB-설계-개요)
  
* [ER 모델 개념적 설계](#ER-모델-개념적-설계)
  
* [관계 모델 논리적 설계](#관계-모델-논리적-설계)

* [트랜잭션(transaction)과 ACID 특성을 보장하는 방법](#트랜잭션(transaction)과-ACID-특성을-보장하는-방법)

* [신뢰성과 회복(Recovery)](#신뢰성과-회복(Recovery))

* [뷰(View)](#뷰(View))

* [정규화 (Normalization)](#정규화 (Normalization))
 
* [인덱스(Index)](#인덱스(Index))
 
</br>

## :bulb: 관계형 DB에서의 관계

 관계형 데이터베이스( MySQL, Oracle, MS-SQL, SQLite 등 )는 엔티티(객체)끼리 관계를 맺을 수 있어서 관계형 DB라는 이름이 붙었습니다. 관계는 두 엔티티가 서로 관련이 있을 때를 말하는데, 다음과 같은 관계를 맺을 수 있습니다.
 * 일대일 (1:1)
 * 일대다 (1:N)
 * 다대다 (N:M)
 
### 1. 일대일 관계(1:1)

   1 : 1 관계란 어느 엔티티 쪽에서 상대 엔티티를 보더라도 반드시 단 하나씩 관계를 가지는 것을 말합니다.
  
   예를 들면, 우리나라에서 결혼제도는 일부일처제입니다.
  즉, 한 남자는 한 여자와, 한 여자는 한 남자와 밖에 결혼을 할 수 없습니다. 
  법적으로 남편을 또는 부인을 2명 이상 둘 수 없습니다.
  이러한 관계를 1:1 관계라고 합니다.
  
  <br>
  
### 2. 일대다 관계(1:N)
  
   1 : M 관계는 한 쪽 엔티티가 관계를 맺은 엔티티 쪽의 여러 객체를 가질 수 있는 것을 의미합니다.
  이 관계는 매우 흔한 방식이며, 실제 DB를 설계할 때 자주 쓰이는 방식입니다.
  
   예를 들면, 부모와 자식 관계라고 생각하시면 됩니다.
  부모는 자식을 1명만 낳을 수도 있고, 2명, 3명, 4명, 10명 그 이상도 낳을수 있습니다.
  DB에서는 이를 부모가 자식을 소유한다고 (has a 관계) 표현합니다.
  반대로 자식 입장에서는 부모(어머니, 아버지의 쌍)를 하나만 가질 수 밖에 없습니다.
  이러한 관계를 1 : N 관계라고 하며, 계층적인 구조로 이해할 수도 있습니다.
  
  <br>
  
### 3. 다대다 관계(N:M)

   N : M 관계는 관계를 가진 양쪽 엔티티 모두에서 1 : M 관계가 존재할 때 나타나는 모습입니다.
  즉, 서로가 서로를 1:N 관계로 보고 있는 것입니다.
  
   예를 들면, 쇼핑몰에서 회원과 상품이 관계를 맺을 수 있습니다.
  한 회원은 쇼핑몰의 여러 상품들을 가질 수 있습니다.
  청바지, 모자, 티셔츠, 남방 등 다 제가 가질 수 있죠.
  반대로 한 티셔츠도 여러 회원들을 가질 수 있습니다.
  하나의 티셔츠를 나도 친구도 부모님도 가질 수 있습니다.
  이처럼 관계를 맺은 두 엔티티가 서로 많이 가질 수 있을 때, 이를 N : M 관계라고 합니다.
  
  <br>
  
### 4. 대표키와 외래키

   table을 각 엔티티를 식별할 수 있는 대표 키(PK, Primary key)가 존재합니다.
  대표키는 중복되지 않는 값입니다. (unique)
  
   예를 들어, 주민 번호는 대한민국 국민들을 식별할 수 있는 대표 키가 됩니다.
  주민등록증이 같은 사람은 있을 수 없기 때문에, 대표 키로서 기능을 할 수 있습니다.
  
  <br>
  
  #### 테이블간의 관계를 맺을 때, 흔히 대표키를 이용하여 관계를 맺습니다.
   예를 들어, 1 : N 관계의 대표적인 예로 게시글과 댓글을 생각해보겠습니다.
  게시글은 여러 댓글들을 가지고 있으며, 댓글은 어떤 한 게시글에만 속해 있습니다.
  따라서 게시글과 댓글은 1:N 관계라 할 수 있습니다.
  
   게시글은 자신이 어떤 댓글들을 가지고 있는지 어떻게 알 수 있을까요?
  댓글 테이블을 설계할 때 컬럼에는 아래와 같은 정보들이 있을 수 있습니다.
  
  * 댓글 아이디(PK)
  * 작성자 명
  * 내용
  * 작성일
  
   여기서 어떤 게시글에 속해 있는지에 대한 정보가 필요하므로 하나의 컬럼이 더 필요한데, 이를 외래키( FK, Foreign key )라 합니다.
  
  * 게시글 아이디(FK)

   여기서 게시글 아이디는 게시글 테이블의 대표 키이며, 이를 댓글 테이블의 외래키로 지정하여 관계를 맺을 수 있습니다.
  
   즉, 게시글은 어떤 댓글들이 자신의 댓글들인지 알 필요 없고, 댓글만 자신이 어떤 게시글에 속하는지만 알면 1:N 관계를 성립할 수 있습니다.
  그 역할이 외래키인 것이죠.

   그렇다면 N:M 관계에서는 어떨까요?
  여기서는 서로가 서로를 1:M , 1:N  관계로 갖고 있기 때문에, 서로의 PK가 자신의 외래키 컬럼으로 갖고 있으면 됩니다.
  일반적으로 N:M 관계는 두 테이블의 대표키를 컬럼으로 갖는 또 다른 테이블을 생성해서 관리합니다.
  
  [ 참고자료 ] <http://www.dbguide.net/db.db?cmd=view&boardUid=12851&boardConfigUid=9&categoryUid=216&boardIdx=40&boardStep=1>

  
  <br>
  
## :bulb: Connection pool
  
### 1. 커넥션 풀(Connection pool)

  커넥션 풀이란 DB와 미리 connection( 연결 )을 해놓은 객체들을 pool( 웅덩이 )에 저장해두었다가, 클라이언트 요청이 오면 커넥션을 빌려주고, 볼일이 끝나면 다시 커넥션을 반납받아 pool에 저장하는 방식을 말합니다.
    
  ![connection](https://user-images.githubusercontent.com/52366841/126592139-6cb3b358-9bf1-426b-8016-0d45ef37fef9.PNG)
    
  클라이언트가 DB와 연결이 필요할 때, connection pool에서 connection을 빌려와 DB에 접근해서 쿼리를 날린 후, 볼 일이 끝나면 사용했던 connection을 다시 pool에 반납을 하는 과정을 표현했습니다.
  
<br>
    
### 2. 특징 / 장단점

 예를 들어, 게시판 웹 애플리케이션을 가정해보겠습니다. 어떤 유저가 게시글을 작성하는 과정을 보면, 그 과정은 다음과 같습니다.
 
 1. 클라이언트가 서버로 게시글 데이터를 전달
 2. 비즈니스 로직 처리
 3. DB와 커넥션을 맺은 후, DB에 게시글 데이터를 저장
 4. DB와 커넥션을 끊고, 비즈니스 로직 처리
 5. 클라이언트에 응답
 
 그런데 서비스가 커져서 유저가 한 명이 아니라, 100명의 유저가 동시에 접속 중이라고 가정해보겠습니다.
위와 같은 경우 매번 DB와 커넥션을 맺고 끊는 과정이 필요한데 커넥션 풀을 사용하게 되면, 미리 연결을 맺고 있는 커넥션들이 있기 때문에 커넥션을 맺고 끊는 과정이 불필요합니다.
즉, DB 접근 시 불필요한 작업(커넥션 생성, 끊기)이 사라지므로 성능향상을 기대할 수 있습니다.

 DB에서는 기본적으로 커넥션을 일정량 제공해줍니다.
그런데 유저가 많아져서 커넥션이 모자랄 경우, 즉 기본으로 제공된 커넥션이 모자랄 경우 원활한 서비스가 이루어지지 않습니다.
커넥션이 반납될 때까지 기다려야 하기 때문이죠. 따라서 유저수에 따라 커넥션을 조절할 필요가 있습니다.

 그렇다고 커넥션을 막 늘리는 것은 좋지 않습니다.
컴퓨터 세계에서는 항상 trade off가 있듯이, 커넥션 풀을 통한 장점도 있지만 단점도 있습니다.
커넥션 또한 객체이므로 메모리를 차지하게 됩니다.
따라서 무작정 많이 늘리는 것은 메모리를 많이 차지하게 되므로 오히려 성능이 떨어지는 결과를 가져옵니다.

<br>

## :bulb: 데이터베이스 시스템 개요

### 1. 정보 시스템

 정보 시스템이란 데이터를 통해 정보를 얻어내는 시스템을 말합니다.
 
 * 데이터
   현실 세계의 단순한 관찰을 통해 수집된 사실 또는 값
 
 * 정보
   특정 해석이나 의미를 갖는 데이터
   
   ![info](https://user-images.githubusercontent.com/52366841/126595897-1debe566-f926-46fa-b00f-bf792189a98b.PNG)
   
 * collect
   데이터를 수집하는 행위
   
 * store
   데이터를 조직화(organize)하여 저장하는 행위
   
 * processing
   원하는 정보를 얻기 위해 데이터들을 처리
   
<br>


### 2. 데이터베이스 시스템과 DBMS

#### 1) 데이터베이스 시스템

 collect, processing, organize 등의 작업을 잘할 수 있도록 도와주는 시스템을 말합니다. 데이터베이스는 다음과 같은 특징이 있습니다.
 
 * 여러 사용자들의 공동 접근이 가능해야 한다.
 * 계속적인 변화를 통해 실시간으로 처리할 수 있는 운영 시스템이어야 한다.
 * 메모리 주소가 아닌 내용을 통해 데이터를 참조한다.
 ##### 실시간 접근성 / 계속적인 변화 / 동시 공유성 / 운영 가능 / 내용 참조
 
 <br>

#### 2) DBMS (Database Management System)

 어플리케이션과 시스템에 저장되어 있는 데이터의 중재자로서의 소프트웨어 시스템을 말합니다.
 흔히 알고있는 MySQL. Oracle, MS-SQL등이 DBMS입니다.

 ![db](https://user-images.githubusercontent.com/52366841/126597091-27149c18-2381-4665-bb30-9ab7b77a952c.PNG)
 
 
    
    
    
    
    
    
    
    
    
    
    
    
    
    
